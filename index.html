<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,user-scalable=yes" />
		<meta name="format-detection" content="telephone=no" />
		<title>CheckerPop</title>
		<link href="./common/css/import.css" rel="stylesheet" />
		<script src="./common/js/jquery.js"></script>
		<script src="./common/js/jquery_matchHeight.js"></script>
		<script src="./common/js/jquery_cookie.js"></script>
		<script>
			$(document).ready(function() {
				
				$("dl#sort dd label input").prop('checked', false);
				$("dl#sort dd label.all input").prop('checked', true);
				$("dl#sort dd label.all").addClass('active');
				
				$.getJSON("./common/json/pps.json", function(data){
					for(var i in data){
						var h = '<li id="' + data[i].slug + '" class="product ' + data[i].finish + ' ' + data[i].shade + '">'
						+ '<a href="https://colourpop.com/products/' + data[i].slug + '" target="_blank">'
						+ '<p class="thumb"><img src="' + data[i].img + '" alt="images" /></p>'
						+ '<h5>' + data[i].category + '</h5>'
						+ '<h6>' + data[i].name + '</h6>'
						+ '<p class="price">$ ' + data[i].price + '</p>'
						+ '<p class="new">' + data[i].new + '</p>'
						+ '</a>'
						+ '<p class="buy"><label><input type="checkbox" name="checkbox_pps" class="checkbox" value="' + data[i].slug + '" /></label></p>'
						+ '<p class="palette">' + data[i].palette + '</p>'
						+ '</li>';
						$("ul#result").append(h);
					}
					function fraction () {
						var alllength = $('ul#result li').length;
						var buylength = $('ul#result li.active').length;
						$("p.fraction span").text(alllength);
						$("p.fraction strong").text(buylength);
					}

					var listitem = 'ul#result > li';
					$(listitem + ':visible').matchHeight();

					if($.cookie("selected_pps")){
						var load_values = $.cookie("selected_pps").split(",");
						for(var i = 0; i < load_values.length; ++i){
							load_values[i] = decodeURIComponent(load_values[i]);
						}
						$("input[type=checkbox][name=checkbox_pps]").each(function(){
							this.checked = $.inArray(this.value, load_values) != -1;
							if($(this).prop('checked')) {
								$(this).parent().parent().parent().addClass("active");
								$(this).parent().parent().parent().addClass("selected");
								$(this).parent().parent().parent().removeClass("unselected");
							} else {
								$(this).parent().parent().parent().removeClass("active");
								$(this).parent().parent().parent().removeClass("selected");
								$(this).parent().parent().parent().addClass("unselected");
							}
						});
						//$("p#txt-cookievalue").text($.cookie("selected_pps"));
					}
					fraction ();
					$("input[type=checkbox][name=checkbox_pps]").change(function(){
						var save_values = [];
						date = new Date();
						$("input[type=checkbox][name=checkbox_pps]").each(function(){
							this.checked && save_values.push(encodeURIComponent(this.value));
						});
						$.cookie("selected_pps", save_values.join(","), { expires: 30 });
						$(this).parent().parent().parent().toggleClass("active");
						$(this).parent().parent().parent().toggleClass("selected");
						$(this).parent().parent().parent().toggleClass("unselected");
						fraction ();
					});
					// 絞り込みに使うタグ（class）を記述してください。数の上限下限はありません。
					var $chkbxFilter_tags =['matte', 'satin', 'metallic', 'duochrome', 'glitter', 'silvers', 'pinks', 'reds', 'oranges', 'corals', 'yellows', 'golds', 'greens', 'blues', 'purples', 'blacks', 'browns', 'neutrals', 'selected', 'unselected']; 
					// 絞り込み対象の要素のHTMLタグを指定してください。（div、section、tr など）
					var $chkbxFilter_blocks = ['li.product']   
					$(function (){
						var $chkbxFilter_all = $('#all');

						//絞り込まないボタンをクリック時にチェックボックスをオフにする
						$chkbxFilter_all.click(function() {
							$(".sort").prop('checked',false);
							$chkbxFilter_all.prop('checked',true);
						});

						//チェックボックスがクリックされた時の動作
						$("dl#sort label input").click(function() {

							$(this).parent().parent().children().removeClass("active");
							$(this).parent().parent().children().children().prop('checked',false);
							$(this).parent().addClass("active");
							$(this).prop('checked', true);

							$.each($chkbxFilter_tags, function() {
								if($('#' + this).is(':checked')) {
									$("#result " + $chkbxFilter_blocks + ":not(." + this + ")").addClass('hidden-not-' + this);
									$chkbxFilter_all.prop('checked',false).parent();
								}
								else if($('#' + this).not(':checked')) {
									$("#result " + $chkbxFilter_blocks + ":not(." + this + ")").removeClass('hidden-not-' + this);
								}
							});

							//チェックボックスが1つも選択されていない場合に、絞り込まないボタンにclass="selected"をつける
							if ($('.sort:checked').length == 0 ){
								$chkbxFilter_all.prop('checked',true).parent().addClass("selected");
								$(".sort").parent().removeClass("active");
							};

							$(listitem + ':visible').matchHeight();
						});     
					});

					//全非選択ボタン
					$("button.deselectall").click( function() {
						$("ul#result li input[type=checkbox][name=checkbox_pps]").prop('checked', false);
						$("ul#result li").removeClass("active");
						$("ul#result li").show().removeClass("selected");
						var save_values = [];
						$("input[type=checkbox][name=checkbox_pps]").each(function(){
							this.checked && save_values.push(encodeURIComponent(this.value));
						});
						$.cookie("selected_pps", save_values.join(","), { expires: 30 });
						$("dl#sort label input[type=checkbox]").prop('checked', false).parent().removeClass("active");
						$('dl#sort label input[type=radio][value=all]').prop('checked', true);
						$('dl#sort label.all').addClass("active");
						fraction();
						return false;
					});

					//全選択ボタン
					$("button.selectall").click( function() {
						$("ul#result li input[type=checkbox][name=checkbox_pps]").prop('checked', true);
						$("ul#result li").show().addClass("active");
						$("ul#result li").show().addClass("selected");
						var save_values = [];
						$("input[type=checkbox][name=checkbox_pps]").each(function(){
							this.checked && save_values.push(encodeURIComponent(this.value));
						});
						$.cookie("selected_pps", save_values.join(","), { expires: 30 });
						$("dl#sort label input[type=checkbox]").prop('checked', false).parent().removeClass("active");
						$('dl#sort label input[type=radio][value=all]').prop('checked', true);
						$('dl#sort label.all').addClass("active");
						fraction();
						return false;
					});
				});
				
				//▼現在のcookieの値を見る
				/*$("button#btn-showcookie").click(function(){
					$("p#txt-cookievalue").text($.cookie("selected_pps"));
					return false;
				});*/
				
				var selected = $.cookie("selected_pps");
				//var url = location.protocol + "//" + location.host + location.pathname + location.search;
				var params = "?pps=" + selected;
				//history.pushState("", "", params);
				for(var i = 0; i < selected.length; ++i){
					selected[i] = decodeURIComponent(selected[i]);
				}
				$("ul#result li input[type=checkbox][name=checkbox_pps]").each(function(){
					this.checked = $.inArray(this.value, selected) != -1;
				});
				
				$("ul#result li").not('.selected').each(function(){
					$(this).addClass("unselected");
				});

			});
		</script>
	</head>
	<body>
		<header class="clearfix">
			<h1>CheckerPop</h1>
			<div id="header-navi">
				<p class="fraction"><strong></strong> / <span></span></p>
				<p class="allselect"><button name="select" value="all" class="btn selectall">Select all</button><button name="select" value="all" class="btn gray deselectall">Deselect all</button></p>
			</div>
		</header>
		<main>
			<section id="products">
				<form>
					<dl id="sort" class="clearfix">
						<dt>Finish</dt>
						<dd>
							<label class="all active"><input type="checkbox" name="finish" id="all" checked="checked">all</label>
							<label class="matte"><input type="checkbox" name="finish" id="matte" class="sort" />matte</label>
							<label class="metallic"><input type="checkbox" name="finish" id="metallic" class="sort" />metallic</label>
							<label class="duochrome"><input type="checkbox" name="finish" id="duochrome" class="sort" />duochrome</label>
							<label class="glitter"><input type="checkbox" name="finish" id="glitter" class="sort" />glitter</label>
						</dd>
						<dt>shade</dt>
						<dd>
							<label class="all active"><input type="checkbox" name="shade" id="all" class="sort" checked="checked" />all</label>
							<label class="silvers"><input type="checkbox" name="shade" id="silvers" class="sort" />silvers</label>
							<label class="pinks"><input type="checkbox" name="shade" id="pinks" class="sort" />pinks</label>
							<label class="reds"><input type="checkbox" name="shade" id="reds" class="sort" />reds</label>
							<label class="yellows"><input type="checkbox" name="shade" class="sort" id="yellows" />yellows</label>
							<label class="oranges"><input type="checkbox" name="shade" class="sort" id="oranges" />oranges</label>
							<label class="corals"><input type="checkbox" name="shade" class="sort" id="corals" />corals</label>
							<label class="golds"><input type="checkbox" name="shade" id="golds" class="sort" />golds</label>
							<label class="greens"><input type="checkbox" name="shade" id="greens" class="sort" />greens</label>
							<label class="blues"><input type="checkbox" name="shade" id="blues" class="sort" />blues</label>
							<label class="purples"><input type="checkbox" name="shade" id="purples" class="sort" />purples</label>
							<label class="blacks"><input type="checkbox" name="shade" id="blacks" class="sort" />blacks</label>
							<label class="browns"><input type="checkbox" name="shade" id="browns" class="sort" />browns</label>
							<label class="neutrals"><input type="checkbox" name="shade" id="neutrals" class="sort" />neutrals</label>
						</dd>
						<dt>Filter</dt>
						<dd>
							<label class="all active"><input type="checkbox" name="filter" id="all" class="sort" checked="checked" />all</label>
							<label class="selected"><input type="checkbox" name="filter" id="selected" class="sort" />selected</label>
							<label class="unselected"><input type="checkbox" name="filter" id="unselected" class="sort" />unselected</label>
						</dd>
					</dl>
					<!--<p id="txt-cookievalue"></p>
					<p><button type="button" id="btn-showcookie">check</button></p>-->
					<ul id="result" class="clearfix">
					</ul>
				</form>
			</section>
		</main>
		<footer>
			<p class="a-center">&copy; Inucolo</p>
		</footer>
	</body>
</html>
